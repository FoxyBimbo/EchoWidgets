<Window x:Class="EchoUI.Views.DesktopFolderWidget"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Folder" Width="320" Height="420"
        WindowStyle="None" AllowsTransparency="True"
        Background="Transparent" Topmost="False"
        ShowInTaskbar="False" ResizeMode="CanResize"
        MouseLeftButtonDown="Window_MouseLeftButtonDown"
        MouseEnter="Window_MouseEnter"
        MouseLeave="Window_MouseLeave"
        SourceInitialized="Window_SourceInitialized">
    <Grid>
        <Border x:Name="RootBorder" Background="{DynamicResource WindowBackgroundSemiBrush}" CornerRadius="14" Margin="8"
                BorderBrush="{DynamicResource AccentBrush}" BorderThickness="1.5">
            <Border.Effect>
                <DropShadowEffect BlurRadius="16" ShadowDepth="2" Opacity="0.5" Color="Black"/>
            </Border.Effect>
            <Grid x:Name="InnerLayout" Margin="12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header -->
                <DockPanel x:Name="HeaderPanel" Grid.Row="0" Margin="0,0,0,6">
                    <Button Content="✕" Click="BtnClose_Click" DockPanel.Dock="Right"
                            Background="Transparent" Foreground="{DynamicResource MutedForegroundBrush}" BorderBrush="Transparent"
                            FontSize="14" Padding="4,0" Cursor="Hand" MinWidth="24"/>
                    <Button x:Name="BtnMinimize" Content="—" Click="BtnMinimize_Click" DockPanel.Dock="Right"
                            Background="Transparent" Foreground="{DynamicResource MutedForegroundBrush}" BorderBrush="Transparent"
                            FontSize="14" Padding="4,0" Cursor="Hand" MinWidth="24"
                            ToolTip="Minimize"/>
                    <Button Content="⚙" Click="BtnSettings_Click" DockPanel.Dock="Right"
                            Background="Transparent" Foreground="{DynamicResource MutedForegroundBrush}" BorderBrush="Transparent"
                            FontSize="14" Padding="4,0" Cursor="Hand" MinWidth="24"
                            ToolTip="Settings"/>
                    <TextBlock x:Name="TxtFolderName" Text="Desktop" FontSize="16"
                               FontWeight="Bold" Foreground="{DynamicResource ForegroundBrush}" VerticalAlignment="Center"
                               TextTrimming="CharacterEllipsis"/>
                </DockPanel>

                <Grid x:Name="ContentPanel" Grid.Row="1">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Dock position selector -->

                    <!-- Sort + Folder path -->
                    <DockPanel Grid.Row="1" Margin="0,0,0,4">
                        <Button Content="Browse…" Click="BtnBrowse_Click" DockPanel.Dock="Right"
                                Padding="10,4" Background="{DynamicResource AccentBrush}" Foreground="{DynamicResource ForegroundBrush}"
                                BorderBrush="Transparent" Margin="8,0,0,0"/>
                        <Button Content="Back" Click="BtnBack_Click" DockPanel.Dock="Left"
                                Padding="8,4" Background="{DynamicResource ControlBackgroundBrush}"
                                Foreground="{DynamicResource ForegroundBrush}" BorderBrush="{DynamicResource BorderBrush}"
                                Margin="0,0,8,0" ToolTip="Go up one folder"/>
                        <TextBox x:Name="TxtPath" IsReadOnly="True" Background="{DynamicResource ControlBackgroundBrush}" Foreground="{DynamicResource ForegroundBrush}"
                                 BorderBrush="{DynamicResource BorderBrush}" Padding="4,4" FontSize="11"
                                 Text="" VerticalContentAlignment="Center"/>
                    </DockPanel>

                    <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="Sort:" Foreground="{DynamicResource MutedForegroundBrush}" VerticalAlignment="Center"
                                   FontSize="11" Margin="0,0,4,0"/>
                        <ComboBox x:Name="CmbSort" Width="100" Height="22" FontSize="11"
                                  Background="{DynamicResource ControlBackgroundBrush}" Foreground="{DynamicResource ForegroundBrush}" BorderBrush="{DynamicResource BorderBrush}"
                                  SelectedIndex="0" SelectionChanged="CmbSort_SelectionChanged">
                            <ComboBoxItem Content="Name"/>
                            <ComboBoxItem Content="Date Modified"/>
                            <ComboBoxItem Content="Size"/>
                            <ComboBoxItem Content="Type"/>
                        </ComboBox>
                        <Button x:Name="BtnSortDir" Content="↑" Click="BtnSortDir_Click"
                                Width="22" Height="22" FontSize="11" Cursor="Hand" Margin="2,0,0,0"
                                Background="{DynamicResource ControlBackgroundBrush}" Foreground="{DynamicResource MutedForegroundBrush}" BorderBrush="{DynamicResource BorderBrush}"
                                ToolTip="Ascending"/>
                    </StackPanel>

                    <!-- File grid -->
                    <ScrollViewer Grid.Row="3" VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled">
                        <ItemsControl x:Name="FileGrid">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel ItemWidth="80" ItemHeight="90"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Button Click="FileItem_Click" Tag="{Binding FullPath}"
                                            PreviewMouseLeftButtonDown="FileItem_PreviewLeftButtonDown"
                                            PreviewMouseRightButtonDown="FileItem_PreviewRightButtonDown"
                                            PreviewMouseMove="FileItem_PreviewMouseMove"
                                            MouseRightButtonUp="FileItem_RightClick"
                                            Background="Transparent" BorderBrush="Transparent"
                                            Cursor="Hand" Padding="2" Width="76" Height="86">
                                        <StackPanel HorizontalAlignment="Center">
                                            <Image Source="{Binding IconImage}" Width="32" Height="32"
                                                   HorizontalAlignment="Center"
                                                   RenderOptions.BitmapScalingMode="HighQuality"/>
                                            <TextBlock Text="{Binding DisplayName}" FontSize="10"
                                                       Foreground="{DynamicResource ForegroundBrush}" TextTrimming="CharacterEllipsis"
                                                       TextAlignment="Center" MaxWidth="72"
                                                       HorizontalAlignment="Center" Margin="0,2,0,0"/>
                                        </StackPanel>
                                    </Button>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Grid>
        </Border>

        <!-- Resize grip — shown only when docked, placed on the inner edge -->
        <Border x:Name="ResizeGrip" Visibility="Collapsed"
                Background="Transparent" Width="6"
                HorizontalAlignment="Right" VerticalAlignment="Stretch"
                Cursor="SizeWE"
                MouseLeftButtonDown="ResizeGrip_MouseDown"
                MouseMove="ResizeGrip_MouseMove"
                MouseLeftButtonUp="ResizeGrip_MouseUp">
            <Border Background="#40FFFFFF" Width="2" CornerRadius="1"
                    VerticalAlignment="Center" Height="40"
                    HorizontalAlignment="Center"/>
        </Border>
        <ResizeGrip x:Name="FloatingResizeGrip" HorizontalAlignment="Right" VerticalAlignment="Bottom"
                    Width="14" Height="14" Margin="0,0,6,6"/>
    </Grid>
</Window>

<Window x:Class="EchoUI.Views.ShortcutPanelWidget"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Shortcut Panel" Width="260" Height="320"
        WindowStyle="None" AllowsTransparency="True"
        Background="Transparent" Topmost="False"
        ShowInTaskbar="False" ResizeMode="NoResize"
        MouseLeftButtonDown="Window_MouseLeftButtonDown"
        SourceInitialized="Window_SourceInitialized">
    <Grid>
        <Border x:Name="RootBorder" Background="{DynamicResource WindowBackgroundSemiBrush}" CornerRadius="14" Margin="8"
                BorderBrush="{DynamicResource AccentBrush}" BorderThickness="1.5">
            <Border.Effect>
                <DropShadowEffect BlurRadius="16" ShadowDepth="2" Opacity="0.5" Color="Black"/>
            </Border.Effect>
            <Grid Margin="12">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Header — click to collapse/expand -->
                <DockPanel Grid.Row="0" Margin="0,0,0,6">
                    <Button Content="✕" Click="BtnClose_Click" DockPanel.Dock="Right"
                            Background="Transparent" Foreground="{DynamicResource MutedForegroundBrush}" BorderBrush="Transparent"
                            FontSize="14" Padding="4,0" Cursor="Hand" MinWidth="24"/>
                    <Button Content="⚙" Click="BtnSettings_Click" DockPanel.Dock="Right"
                            Background="Transparent" Foreground="{DynamicResource MutedForegroundBrush}" BorderBrush="Transparent"
                            FontSize="14" Padding="4,0" Cursor="Hand" MinWidth="24"
                            ToolTip="Settings"/>
                    <Button Content="＋" Click="BtnAdd_Click" DockPanel.Dock="Right"
                            Background="Transparent" Foreground="{DynamicResource MutedForegroundBrush}" BorderBrush="Transparent"
                            FontSize="14" Padding="4,0" Cursor="Hand" MinWidth="24"
                            ToolTip="Add shortcut"/>

                    <!-- Title — click+release to toggle, hold+drag to move, double-click to edit -->
                    <Border Background="Transparent" Cursor="Hand"
                            PreviewMouseLeftButtonDown="TitleBar_MouseDown"
                            PreviewMouseMove="TitleBar_MouseMove"
                            PreviewMouseLeftButtonUp="TitleBar_MouseUp">
                        <TextBlock x:Name="TxtTitle" Text="Shortcuts" FontSize="16"
                                   FontWeight="Bold" Foreground="{DynamicResource ForegroundBrush}" VerticalAlignment="Center"
                                   TextTrimming="CharacterEllipsis"/>
                    </Border>
                </DockPanel>

                <!-- Dock position selector -->
                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,8">
                    <TextBlock Text="Dock:" Foreground="{DynamicResource MutedForegroundBrush}" VerticalAlignment="Center"
                               FontSize="10" Margin="0,0,6,0"/>
                    <Button x:Name="BtnDockLeft" Content="◀" Click="BtnDock_Click" Tag="Left"
                            Width="22" Height="20" FontSize="10" Cursor="Hand" Margin="0,0,2,0"
                            Background="{DynamicResource ControlBackgroundBrush}" Foreground="{DynamicResource MutedForegroundBrush}" BorderBrush="{DynamicResource BorderBrush}"
                            ToolTip="Dock Left"/>
                    <Button x:Name="BtnDockTop" Content="▲" Click="BtnDock_Click" Tag="Top"
                            Width="22" Height="20" FontSize="10" Cursor="Hand" Margin="0,0,2,0"
                            Background="{DynamicResource ControlBackgroundBrush}" Foreground="{DynamicResource MutedForegroundBrush}" BorderBrush="{DynamicResource BorderBrush}"
                            ToolTip="Dock Top"/>
                    <Button x:Name="BtnDockBottom" Content="▼" Click="BtnDock_Click" Tag="Bottom"
                            Width="22" Height="20" FontSize="10" Cursor="Hand" Margin="0,0,2,0"
                            Background="{DynamicResource ControlBackgroundBrush}" Foreground="{DynamicResource MutedForegroundBrush}" BorderBrush="{DynamicResource BorderBrush}"
                            ToolTip="Dock Bottom"/>
                    <Button x:Name="BtnDockRight" Content="▶" Click="BtnDock_Click" Tag="Right"
                            Width="22" Height="20" FontSize="10" Cursor="Hand" Margin="0,0,2,0"
                            Background="{DynamicResource ControlBackgroundBrush}" Foreground="{DynamicResource MutedForegroundBrush}" BorderBrush="{DynamicResource BorderBrush}"
                            ToolTip="Dock Right"/>
                    <Button x:Name="BtnUndock" Content="⤢" Click="BtnUndock_Click"
                            Width="26" Height="20" FontSize="10" Cursor="Hand" Padding="0"
                            Background="{DynamicResource ControlBackgroundBrush}" Foreground="{DynamicResource MutedForegroundBrush}" BorderBrush="{DynamicResource BorderBrush}"
                            ToolTip="Float freely" Margin="4,0,0,0"/>
                </StackPanel>

                <!-- Collapsible content -->
                <StackPanel x:Name="ContentPanel" Grid.Row="2">
                    <!-- Inline title editor (hidden by default) -->
                    <DockPanel x:Name="TitleEditPanel" Visibility="Collapsed" Margin="0,0,0,8">
                        <Button Content="✓" Click="BtnTitleSave_Click" DockPanel.Dock="Right"
                                Background="{DynamicResource AccentBrush}" Foreground="{DynamicResource ForegroundBrush}" BorderBrush="Transparent"
                                Padding="8,4" Margin="4,0,0,0" Cursor="Hand"/>
                        <TextBox x:Name="TxtTitleEdit" Background="{DynamicResource ControlBackgroundBrush}" Foreground="{DynamicResource ForegroundBrush}"
                                 BorderBrush="{DynamicResource BorderBrush}" Padding="4,4" FontSize="13"/>
                    </DockPanel>

                    <!-- Shortcut list -->
                    <ScrollViewer VerticalScrollBarVisibility="Auto"
                                  HorizontalScrollBarVisibility="Disabled"
                                  MaxHeight="400">
                        <ItemsControl x:Name="ShortcutList">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="{DynamicResource ControlBackgroundBrush}" CornerRadius="6" Margin="0,0,0,4"
                                            Padding="6,4" Cursor="Hand"
                                            MouseLeftButtonDown="Shortcut_Click"
                                            MouseRightButtonDown="Shortcut_RightClick"
                                            Tag="{Binding}">
                                        <DockPanel>
                                            <Button Content="⋮" DockPanel.Dock="Right"
                                                    Click="BtnShortcutMenu_Click"
                                                    Tag="{Binding}"
                                                    Background="Transparent" Foreground="{DynamicResource MutedForegroundBrush}"
                                                    BorderBrush="Transparent" FontSize="14"
                                                    Padding="4,0" Cursor="Hand" VerticalAlignment="Center"/>
                                            <Image Source="{Binding IconImage}" Width="24" Height="24"
                                                   Margin="0,0,8,0" VerticalAlignment="Center"
                                                   RenderOptions.BitmapScalingMode="HighQuality"/>
                                            <TextBlock Text="{Binding Name}" Foreground="{DynamicResource ForegroundBrush}"
                                                       FontSize="12" TextTrimming="CharacterEllipsis"
                                                       VerticalAlignment="Center"/>
                                        </DockPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
